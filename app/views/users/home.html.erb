<% if signed_in? %>
  <% current_color = randomColor() %>  
  <script>
    function buttonPress(userID){      
      var friend_id = "friends[" + userID + "]";
      var image_id = "image_"  + userID;

      var visible = document.getElementById(friend_id).value;
      if(visible == "false"){        
        document.getElementById(image_id).setAttribute("class", "avatar_selected");   
        document.getElementById(friend_id).value = "true";
      }else{ 
        document.getElementById(image_id).setAttribute("class", "avatar");
        document.getElementById(friend_id).value = "false";
      }  
    }
    </script>
    
<div class="row-fluid"> 
  
    <div class="span3">
      <div class="well sidebar-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Send Message</li>
            <%= form_for(@micropost) do |f| %>
              <li><%= render 'shared/error_messages', object: f.object %></li>   
              <li><%= f.text_field :content, placeholder: "Dont forget to buy milk!", maxlength: "100", autofocus: "true" %><%= f.hidden_field :filter, value: current_color %></li> 
              <li class="nav-header">Visible for</li>             
              <%  @friends.each do |u| %>          
                  <li style="font-size: 10px;color: black;">
                    <a onClick=buttonPress('<%=u.id%>')><img src="<%=u.avatar%>" id="image_<%=u.id%>" size="48x48" class="avatar") %></a>
                    <p style="font-size: 10px;color: black;"><%= u.name %></p>
                    <input type="hidden" id="friends[<%=u.id%>]" name="friends[<%=u.id%>]" value="false"/>
                  </li>
              <% end %>
              <% if @friends.length == 0 %><%= f.text_field :recipients, placeholder: "Email", maxlength: "100" %><% end %> 
              <li><%= f.submit "Share", class: "btn btn-success" %></li>
          <% end %> 
          </ul>
        </div><!--/.well -->
    </div>    

    <div class="span8">    
      <%  @microposts.each do |micropost| %> 
        <div class="row-fluid">
        <div class="span12">
        <%= render micropost %>
        </div> 
       </div>  
      <% end %>
    </div>
    <div class="span1"></div>
</div>

<% else %>
  <div class="center hero-unit" style="background-color: #ffffff;">
      <h1>Private sharing: faster</h1>
      <p>
        Private sharing the way it's suppose to be. 
      </p>
      
      <br/>
      <p><%= link_to "Sign up now", signup_path, class: "btn btn-large btn-success" %></p> 
      <p>
        <b>Lugogram is currently in development. <b/>
      </p> 
  </div>
  <div class="container-fluid">  
  <%= render 'shared/lugogram_message', avatar: '/images/ninja-avatar-48x48.png', name: 'Julia', time: "", visibility: "", message:'Missing you :(', color: randomColor() %>
  <%= render 'shared/lugogram_message', avatar: '/images/ninja-avatar-48x48.png', name: 'Lisa', time: "", visibility: "", message:'We are leaving for the pizza place now, feel free to join.', color: randomColor() %>
  <%= render 'shared/lugogram_message', avatar: '/images/ninja-avatar-48x48.png', name: 'Ben', time: "", visibility: "", message:'Dont forget the milk!', color: randomColor() %> 
  </div>
<% end %> 