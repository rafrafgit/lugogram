<% if signed_in? %>
  <% current_color = randomColor() %>  
  <script>
    function buttonPress(userID){      
      var friend_id = "friends[" + userID + "]";
      //var image_id = "image_"  + userID;
      var name_id = "name_"  + userID;
      var select_id = "select_"  + userID;

      var visible = document.getElementById(friend_id).value;
      if(visible == "false"){        
       // document.getElementById(image_id).setAttribute("class", "avatar_selected");   
        document.getElementById(name_id).setAttribute("class", "name_selected");
        document.getElementById(select_id).setAttribute("class", "avatar_selected");       
        document.getElementById(friend_id).value = "true";
      }else{ 
       // document.getElementById(image_id).setAttribute("class", "invisible");
        document.getElementById(name_id).setAttribute("class", "name_unselected"); 
        document.getElementById(select_id).setAttribute("class", "avatar");
        document.getElementById(friend_id).value = "false";
      }  
    }
    
    function makeShort() 
    {
       var longUrl=document.getElementById("url").value;
       if (longUrl != null && longUrl.length > 0){
          var request = gapi.client.urlshortener.url.insert({
            'resource': {
            'longUrl': longUrl
          }
          });
          request.execute(function(response) 
          {    
              if(response.id != null){                

                  document.getElementById("url").value = response.id;
              }
          
       
          });
        }
     }

     function submitPost(){
      document.getElementById("micropost_content").value = document.getElementById("message").value + ' ' + document.getElementById("url").value;
      document.forms["micropost"].submit();
     }
     
    function load()
    {
        //Get your own Browser API Key from  https://code.google.com/apis/console/
        gapi.client.setApiKey('AIzaSyCF1DzfpTiMuzKk2TjudaZ-bPIPGjaL6NY');
        gapi.client.load('urlshortener', 'v1',function(){document.getElementById("output").innerHTML="";});
     
    }
    window.onload = load;
     
    </script>
    <script src="https://apis.google.com/js/client.js"> </script>
       
    
<div class="row-fluid"> 
  
    <div class="span4">
      <div class="well sidebar-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Message</li>
            <li><input type="text" id="message" placeholder="Dont forget to buy milk!" maxlength="100" autofocus="true"/></li>
            <%= form_for(@micropost) do |f| %>
              <li><%= render 'shared/error_messages', object: f.object %></li>   
                <%= f.hidden_field :filter, value: current_color %>
                <%= f.hidden_field :content %>
              </li>
              <li class="nav-header">Link (opional)</li>
              <li><input type="text" id="url" name="url" value="" onBlur="makeShort();" /></li> 
              
              
              <% if @friends.length == 0 %>
                <li><%= f.text_field :recipients, placeholder: "Email", maxlength: "100" %></li>
              <% else %>   
                <li><div class="row-fluid"><div class="span6" style="margin-bottom:20px"><div class="btn-group">
                  <button class="btn">To</button>
                  <button class="btn dropdown-toggle" data-toggle="dropdown">
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu">
                    <%  @friends.each do |u| %>          
                      <li><a onClick=buttonPress('<%=u.id%>')><img src="<%=u.getAvatarURL%>" id="select_<%=u.id%>" size="24x24" class="avatar") %><p style="font-size: 10px;color: black;"><%= u.name %></p></a></li>
                      <input type="hidden" id="friends[<%=u.id%>]" name="friends[<%=u.id%>]" value="false"/> 
                   <% end %>
                  </ul>
                </div></div>
                <div class="span6" style="margin-bottom:20px"><%= f.button "Share", class: "btn btn-success", onClick: "submitPost();"%></div>
                </div>
               </li> 
               <li class="nav-header">Visible to friends</li>
               <%  @friends.each do |u| %>          
                 <li style="margin-top:0px;margin-bottom:0px">
                    <p id="name_<%=u.id%>" class="name_unselected"><%= u.name %></p> 
                 </li> 
              <% end %> 
              
              
              <% end %> 
          <% end %> 
          </ul>
        </div><!--/.well -->
    </div>    

    <div class="span8">    
      <%  @microposts.each do |micropost| %> 
        <div class="row-fluid">
        <div class="span12">
        <%= render micropost %>
        </div> 
       </div>  
      <% end %>
    </div>
</div>

<% else %>
<div class="row-fluid"><div class="span12">  
  <div class="center hero-unit" style="background-color: #ffffff;">
      <h1>Private sharing: faster</h1>
      <p>Private sharing the way it's suppose to be.</p>
      <br/>
      <p><%= link_to "Sign up now", signup_path, class: "btn btn-large btn-success" %></p> 
  </div>
</div></div>
  <div class="row-fluid">
  <%= render 'shared/lugogram_message', avatar: defaultAvatar, name: 'Julia', time: "", visibility: "", message:'Missing you :(', color: randomColor() %>
  <%= render 'shared/lugogram_message', avatar: defaultAvatar, name: 'Lisa', time: "", visibility: "", message:'We are leaving for the pizza place now, feel free to join.', color: randomColor() %>
  <%= render 'shared/lugogram_message', avatar: defaultAvatar, name: 'Ben', time: "", visibility: "", message:'Dont forget the milk!', color: randomColor() %> 
  </div>
<% end %> 